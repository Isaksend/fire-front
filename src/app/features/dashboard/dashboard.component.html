<div class="dashboard-shell">

  <app-header />

  <div class="body-wrap">

    <app-sidebar (filtersChange)="onFiltersChange($event)" />

    <main class="main">

      <!-- Toolbar -->
      <div class="main-toolbar">
        <div>
          <div class="main-title">
            Incoming Tickets
            <span>Â· {{ totalCount }}</span>
          </div>
          <div class="main-subtitle">
            Received after business hours Â· Auto-assigned via Round Robin
          </div>
        </div>
        <div class="toolbar-right">
          <a routerLink="/upload" class="btn-icon">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
            Upload CSV
          </a>
          <button class="btn-primary" (click)="triggerProcessing()" [disabled]="isProcessing">
            <svg *ngIf="!isProcessing" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="1 4 1 10 7 10"/>
              <path d="M3.51 15a9 9 0 1 0 .49-3.51"/>
            </svg>
            <svg *ngIf="isProcessing" class="spin" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/>
              <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/>
              <line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/>
              <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/>
            </svg>
            {{ isProcessing ? 'Processingâ€¦' : 'Run Assignment' }}
          </button>
        </div>
      </div>

      <!-- Loading state -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="loading-spinner"></div>
        <span>Connecting to backendâ€¦</span>
      </div>

      <!-- Empty state -->
      <div class="empty-state" *ngIf="!isLoading && tickets.length === 0">
        <div class="empty-icon">ðŸ“­</div>
        <div class="empty-title">No tickets found</div>
        <div class="empty-sub">Upload a CSV file or adjust your filters</div>
        <a routerLink="/upload" class="btn-primary" style="margin-top: 16px;">Upload Tickets</a>
      </div>

      <!-- Ticket grid -->
      <div class="tickets-grid" *ngIf="!isLoading && tickets.length > 0">
        <app-ticket-card
          *ngFor="let ticket of tickets; trackBy: trackById"
          [ticket]="ticket"
        />
      </div>

    </main>
  </div>

  <app-footer [stats]="stats" [managers]="managers" [lastRunTime]="lastRunTime" />

</div>
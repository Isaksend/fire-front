<div class="ticket-card" [class]="sentimentClass" *ngIf="ticket">

  <!-- Header row -->
  <div class="card-header">
    <div>
      <div class="card-id">{{ ticketId }}</div>
      <div class="status-row">
        <div class="status-dot" [class]="statusDotClass"></div>
        <span class="status-text" [class]="statusDotClass">{{ statusLabel.toUpperCase() }}</span>
      </div>
    </div>
    <div class="card-badges">
      <span class="badge" [class]="sentimentBadge">â— {{ ticket.sentiment }}</span>
      <span class="badge" [class]="segmentBadge">{{ ticket.segment }}</span>
      <span class="badge badge-lang">{{ ticket.language }}</span>
    </div>
  </div>

  <!-- Client info -->
  <div class="card-client">
    <div class="client-name">{{ ticket.client_guid | slice:0:12 }}...</div>
    <div class="client-sub">
      {{ ticket.gender }} Â· {{ clientAge }}
      <span *ngIf="ticket.city"> Â· {{ ticket.city }}, {{ ticket.country }}</span>
    </div>
  </div>

  <!-- Priority bar -->
  <div class="priority-bar-wrap">
    <span class="priority-label" [style.color]="priorityColor">Priority</span>
    <div class="priority-bar">
      <div class="priority-fill" [class]="priorityClass" [style.width]="priorityWidth"></div>
    </div>
    <span class="priority-num" [style.color]="priorityColor">{{ ticket.priority }}</span>
  </div>

  <!-- Type badge -->
  <div style="margin-bottom: 10px;">
    <span class="badge badge-type">{{ ticket.ticket_type }}</span>
  </div>

  <!-- Summary -->
  <div class="card-summary" *ngIf="ticket.summary">{{ ticket.summary }}</div>
  <div class="card-summary muted" *ngIf="!ticket.summary && ticket.description">
    {{ ticket.description | slice:0:120 }}...
  </div>

  <!-- Recommended action -->
  <div class="recommended-action" *ngIf="ticket.recommended_action">
    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
    </svg>
    {{ ticket.recommended_action }}
  </div>

  <!-- Geo -->
  <div class="card-geo" *ngIf="geoString">
    <span class="geo-icon">ğŸ“</span>
    {{ geoString }}
  </div>

  <!-- Footer -->
  <div class="card-footer">
    <div class="attachments">
      <span class="attach-icon">ğŸ“</span>
      <span *ngIf="hasAttachments">{{ ticket.attachments }}</span>
      <span *ngIf="!hasAttachments && !hasAiPlaceholder" class="muted">No files</span>
      <span *ngIf="hasAiPlaceholder" class="attach-ai">AI generated</span>
    </div>
    <div class="created-at">
      {{ ticket.created_at | date:'dd MMM, HH:mm' }}
    </div>
  </div>

  <!-- Assigned manager -->
  <div class="manager-assigned" *ngIf="ticket.assigned_manager">
    <div class="mgr-avatar">{{ managerInitials }}</div>
    <span class="muted">Assigned to</span>
    <span class="mgr-name">{{ ticket.assigned_manager.full_name }}</span>
    <span class="mgr-meta">
      {{ ticket.assigned_manager.position?.split(' ')[0] }}
      Â· {{ ticket.assigned_manager.skills }}
      Â· Load: {{ ticket.assigned_manager.current_workload }}
    </span>
  </div>
  <div class="manager-assigned unassigned" *ngIf="!ticket.assigned_manager">
    <div class="mgr-avatar unassigned-avatar">?</div>
    <span class="muted">Unassigned â€” pending processing</span>
  </div>

</div>
{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport { interval } from 'rxjs';\nimport { switchMap, startWith } from 'rxjs/operators';\nimport { HeaderComponent } from '../../shared/components/header/header.component';\nimport { SidebarComponent } from '../../shared/components/sidebar/sidebar.component';\nimport { FooterComponent } from '../../shared/components/footer/footer.component';\nimport { TicketCardComponent } from '../../shared/components/ticket-card/ticket-card.component';\nlet DashboardComponent = class DashboardComponent {\n  constructor(api) {\n    this.api = api;\n    this.tickets = [];\n    this.managers = [];\n    this.stats = {\n      total: 0,\n      new: 0,\n      in_progress: 0,\n      resolved: 0,\n      urgent: 0\n    };\n    this.filters = {};\n    this.lastRunTime = '';\n    this.isProcessing = false;\n    this.isLoading = true;\n  }\n  ngOnInit() {\n    this.loadManagers();\n    this.startPolling();\n  }\n  ngOnDestroy() {\n    this.pollSub?.unsubscribe();\n  }\n  startPolling() {\n    this.pollSub = interval(8000).pipe(startWith(0), switchMap(() => this.api.getTickets(this.filters))).subscribe({\n      next: tickets => {\n        this.tickets = tickets;\n        this.isLoading = false;\n        this.api.getStats().subscribe(s => this.stats = s);\n      },\n      error: () => {\n        this.isLoading = false;\n      }\n    });\n  }\n  loadManagers() {\n    this.api.getManagers().subscribe(m => this.managers = m);\n  }\n  onFiltersChange(filters) {\n    this.filters = filters;\n    this.pollSub?.unsubscribe();\n    this.isLoading = true;\n    this.startPolling();\n  }\n  triggerProcessing() {\n    this.isProcessing = true;\n    this.api.triggerProcessing().subscribe({\n      next: () => {\n        this.lastRunTime = new Date().toLocaleTimeString('en-KZ', {\n          hour: '2-digit',\n          minute: '2-digit'\n        });\n        setTimeout(() => this.isProcessing = false, 3000);\n      },\n      error: () => this.isProcessing = false\n    });\n  }\n  trackById(_, t) {\n    return t.id;\n  }\n  get totalCount() {\n    return this.tickets.length;\n  }\n};\nDashboardComponent = __decorate([Component({\n  selector: 'app-dashboard',\n  standalone: true,\n  imports: [CommonModule, FormsModule, RouterModule, HeaderComponent, SidebarComponent, FooterComponent, TicketCardComponent],\n  templateUrl: './dashboard.component.html',\n  styleUrls: ['./dashboard.component.scss']\n})], DashboardComponent);\nexport { DashboardComponent };","map":{"version":3,"names":["Component","CommonModule","FormsModule","RouterModule","interval","switchMap","startWith","HeaderComponent","SidebarComponent","FooterComponent","TicketCardComponent","DashboardComponent","constructor","api","tickets","managers","stats","total","new","in_progress","resolved","urgent","filters","lastRunTime","isProcessing","isLoading","ngOnInit","loadManagers","startPolling","ngOnDestroy","pollSub","unsubscribe","pipe","getTickets","subscribe","next","getStats","s","error","getManagers","m","onFiltersChange","triggerProcessing","Date","toLocaleTimeString","hour","minute","setTimeout","trackById","_","t","id","totalCount","length","__decorate","selector","standalone","imports","templateUrl","styleUrls"],"sources":["C:\\Users\\Batyr\\Downloads\\freedom_case\\frontend\\src\\app\\features\\dashboard\\dashboard.component.ts"],"sourcesContent":["import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { RouterModule } from '@angular/router';\r\nimport { Subscription, interval } from 'rxjs';\r\nimport { switchMap, startWith } from 'rxjs/operators';\r\n\r\nimport { ApiService } from '../../core/services/api.service';\r\nimport { Ticket, Manager, Stats, TicketFilters } from '../../core/models/ticket.model';\r\nimport { HeaderComponent } from '../../shared/components/header/header.component';\r\nimport { SidebarComponent } from '../../shared/components/sidebar/sidebar.component';\r\nimport { FooterComponent } from '../../shared/components/footer/footer.component';\r\nimport { TicketCardComponent } from '../../shared/components/ticket-card/ticket-card.component';\r\n\r\n@Component({\r\n  selector: 'app-dashboard',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule, FormsModule, RouterModule,\r\n    HeaderComponent, SidebarComponent, FooterComponent, TicketCardComponent\r\n  ],\r\n  templateUrl: './dashboard.component.html',\r\n  styleUrls: ['./dashboard.component.scss']\r\n})\r\nexport class DashboardComponent implements OnInit, OnDestroy {\r\n  tickets: Ticket[] = [];\r\n  managers: Manager[] = [];\r\n  stats: Stats = { total: 0, new: 0, in_progress: 0, resolved: 0, urgent: 0 };\r\n  filters: TicketFilters = {};\r\n  lastRunTime = '';\r\n  isProcessing = false;\r\n  isLoading = true;\r\n\r\n  private pollSub?: Subscription;\r\n\r\n  constructor(private api: ApiService) {}\r\n\r\n  ngOnInit() {\r\n    this.loadManagers();\r\n    this.startPolling();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.pollSub?.unsubscribe();\r\n  }\r\n\r\n  startPolling() {\r\n    this.pollSub = interval(8000).pipe(\r\n      startWith(0),\r\n      switchMap(() => this.api.getTickets(this.filters))\r\n    ).subscribe({\r\n      next: tickets => {\r\n        this.tickets = tickets;\r\n        this.isLoading = false;\r\n        this.api.getStats().subscribe(s => this.stats = s);\r\n      },\r\n      error: () => { this.isLoading = false; }\r\n    });\r\n  }\r\n\r\n  loadManagers() {\r\n    this.api.getManagers().subscribe(m => this.managers = m);\r\n  }\r\n\r\n  onFiltersChange(filters: TicketFilters) {\r\n    this.filters = filters;\r\n    this.pollSub?.unsubscribe();\r\n    this.isLoading = true;\r\n    this.startPolling();\r\n  }\r\n\r\n  triggerProcessing() {\r\n    this.isProcessing = true;\r\n    this.api.triggerProcessing().subscribe({\r\n      next: () => {\r\n        this.lastRunTime = new Date().toLocaleTimeString('en-KZ', { hour: '2-digit', minute: '2-digit' });\r\n        setTimeout(() => this.isProcessing = false, 3000);\r\n      },\r\n      error: () => this.isProcessing = false\r\n    });\r\n  }\r\n\r\n  trackById(_: number, t: Ticket) { return t.id; }\r\n\r\n  get totalCount(): number { return this.tickets.length; }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}